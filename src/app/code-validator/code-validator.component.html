<div class="container">
  <mat-card class="qr-card">
    <mat-card-header>
      <mat-card-title>Validar Asistencia</mat-card-title>
      <mat-card-subtitle>
        Escanea el código QR del alumno o ingresá el token manualmente
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <button
        mat-fab
        [color]="scanning ? 'warn' : 'primary'"
        (click)="toggleScanner()"
        class="camera-button"
      >
        <mat-icon>{{ scanning ? 'close' : 'photo_camera' }}</mat-icon>
      </button>

      <div *ngIf="scanning" class="camera-container">
        <video #video autoplay muted playsinline></video>
        <p class="hint">Apuntá la cámara al código QR</p>
      </div>

      <div class="manual-input" [class.disabled]="scanning">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ingresar token manualmente</mat-label>
          <input
            matInput
            [(ngModel)]="token"
            [disabled]="scanning"
            placeholder="Ingrese el token"
          />
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          (click)="validateToken()"
          [disabled]="scanning"
          class="validate-button"
        >
          Validar Token
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="validatedStudents.length > 0" class="success-card">
    <mat-card-header>
      <mat-card-title>Alumnos Validados</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-list>
        <mat-list-item *ngFor="let student of validatedStudents; let i = index">
          <div [class.highlight]="student === lastValidated">
            <strong>{{ i + 1 }}.</strong> {{ student.name }} - {{ student.id }}
          </div>
        </mat-list-item>
      </mat-list>
    </mat-card-content>
  </mat-card>
</div>
