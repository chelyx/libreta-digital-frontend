<div *ngIf="loading">Cargando...</div>

<table class="table table-striped" *ngIf="!loading">
  <thead>
    <tr>
      <th>Legajo</th>
      <th>Alumno</th>
      <th>Email</th>
      <th style="width:210px">Calificación</th>
      <th style="width:160px"></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let r of rows">
      <td>{{ r.legajo }}</td>
      <td>{{ r.nombre }}</td>
      <td>{{ r.email }}</td>

      <td>
        <!-- Select con 0..10 + AUS. Deshabilitado si la fila está bloqueada y no está en modo edición -->
        <mat-form-field appearance="outline" style="width:200px;">
          <mat-label>Nota</mat-label>
          <mat-select [(ngModel)]="r.notaValor" [disabled]="r.bloqueada && !r.editando">
            <mat-option *ngFor="let op of opciones" [value]="op">
              {{ op === 'AUS' ? 'Ausente' : op }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </td>

      <td>
        <!-- Si está bloqueada y no editando, muestro el botón para habilitar edición -->
        <button *ngIf="r.bloqueada && !r.editando"
                mat-stroked-button color="primary"
                (click)="habilitarEdicion(r)">
          MODIFICAR NOTAS
        </button>
        <span *ngIf="r.bloqueada && !r.editando" class="text-muted" style="margin-left:.5rem;">
          (bloqueada por envío ya realizado)
        </span>
      </td>
    </tr>
  </tbody>
</table>

<div style="display:flex; gap:.5rem; align-items:center; margin-top:.75rem;">
  <button mat-raised-button color="primary" (click)="guardar()" [disabled]="loading">Guardar y notificar</button>
  <span *ngIf="feedback">{{ feedback }}</span>
</div>
