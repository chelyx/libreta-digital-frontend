<div class="main-content">
  <div class="content-wrapper">
    <h2 class="title">Historial de Asistencia</h2>
    <p class="subtitle">Registro completo de Asistencias</p>

    <div class="search-section">
      <div class="search-option">
        <div class="option-header">
          <span class="step-number">1</span>
          <label class="label">Seleccionar Curso</label>
        </div>
        <select class="select-input" [(ngModel)]="cursoSeleccionado" (change)="onCursoChange()">
          <option value="" disabled selected>Seleccione un curso</option>
          <option *ngFor="let curso of cursos" [value]="curso.id">
            {{ curso.nombre }} - {{ curso.codigo }}
          </option>
        </select>
        <p class="help-text">Elige un curso de la lista disponible</p>
      </div>

      <div class="divider">
        <span class="divider-text">o</span>
      </div>

      <div class="search-option">
        <div class="option-header">
          <span class="step-number">2</span>
          <label class="label">Buscar por Código de Curso</label>
        </div>
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input
            type="text"
            class="search-input"
            [(ngModel)]="cursoIdBusqueda"
            (input)="onBuscarPorId()"
            placeholder="Ingresa el Código del curso (ej: K101)"
          />
        </div>
        <p class="help-text">Introduce el código único del curso para búsqueda rápida</p>
      </div>

      <button class="search-button" (click)="buscarCurso()" [disabled]="!cursoSeleccionado && !cursoIdBusqueda">
        <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        Buscar Curso
      </button>
    </div>

    <div class="info-note">
      <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <p>Podes buscar el curso seleccionándolo de la lista o ingresando directamente su código.</p>
    </div>

    <div class="results-section" *ngIf="cursoSeleccionado || cursoIdBusqueda">
      <h3 class="results-title">Asistencias del curso</h3>

      <div class="loading" *ngIf="cargando">
        <svg class="spinner" viewBox="0 0 50 50">
          <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
        </svg>
        <span>Cargando asistencias...</span>
      </div>

      <div class="error" *ngIf="!cargando && errorMsg">
        {{ errorMsg }}
      </div>

      <div class="table-wrapper" *ngIf="!cargando && !errorMsg && asistencias.length">
        <table class="asist-table">
          <thead>
          <tr>
            <th>Fecha</th>
            <th>Alumno</th>
            <th>Presente</th>
            <th class="acciones-column">Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let a of asistencias">
            <td>{{ a.fecha | date: 'yyyy-MM-dd' }}</td>
            <td>{{ a.nombre || a.id }}</td>
            <td>
              <div *ngIf="!estaEditando(a)">
                  <span class="pill" [class.ok]="a.presente" [class.no]="!a.presente">
                    {{ a.presente ? 'Sí' : 'No' }}
                  </span>
              </div>
              <div *ngIf="estaEditando(a)" class="edit-buttons">
                <button class="toggle-button"
                        [class.active]="a.presente"
                        (click)="cambiarPresente(a, true)">
                  Sí
                </button>
                <button class="toggle-button"
                        [class.active]="!a.presente"
                        (click)="cambiarPresente(a, false)">
                  No
                </button>
              </div>
            </td>
            <td class="acciones-column">
              <div *ngIf="!estaEditando(a)">
                <button mat-icon-button
                        class="edit-button"
                        (click)="editarAsistencia(a)"
                        matTooltip="Editar asistencia">
                  <mat-icon>edit</mat-icon>
                </button>
              </div>
              <div *ngIf="estaEditando(a)" class="action-buttons">
                <button mat-icon-button
                        class="save-button"
                        (click)="guardarAsistencia(a)"
                        matTooltip="Guardar">
                  <mat-icon>check</mat-icon>
                </button>
                <button mat-icon-button
                        class="cancel-button"
                        (click)="cancelarEdicion(a)"
                        matTooltip="Cancelar">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="empty" *ngIf="!cargando && !errorMsg && (!asistencias || asistencias.length === 0)">
        No hay asistencias para mostrar.
      </div>
    </div>

  </div>
</div>
